[toc]

# 数字证书

## 一、摘要算法

> 为防止信息被篡改，但我们不知道。

<img src="pic/2%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E4%B8%8E%E8%AF%81%E4%B9%A6%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F.assets/image-20220614190335009.png" alt="image-20220614190335009" style="zoom: 33%;" />



摘要算法就是哈希算法

#### 1)工作过程

1. 为信息生成一个`哈希值A`
2. 将信息和`哈希值A`一起发送给对方
3. 对方将信息用同样的规则计算出`哈希值B`
4. 比较AB两个哈希值是否相同如果是，则信息是没有被修改过的

**特点**

- 单向的，只能通过文件计算出hash值，不能通过hash值得到文件



#### 2) 作用

**保证消息的完整性**: 如果信息修改则hash值出错，对应不上

## 二、数字签名

> Hacker可以将hash值和信息一起篡改，发送给对方一个Hacker的信息和他的信息生成的hash值
>
> - 我们不能证明信息和hash值来自于Server



#### 1)数字签名是什么？

数字签名采用 `非对称加密` 来确保服务器身份。

HTTPS中用非对称加密：

- 私钥加密【hash值】生成数字签名
- Client用公钥解密 数字签名 获得【hash值】
- 能够解开说明是服务器发送过来的(只有对应的公钥，才能解开服务器的私钥发来的数字签名)

<img src="pic/2%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E4%B8%8E%E8%AF%81%E4%B9%A6%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F.assets/image-20220614191357322.png" alt="image-20220614191357322" style="zoom:33%;" />

<img src="pic/2%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E4%B8%8E%E8%AF%81%E4%B9%A6%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F.assets/image-20220614190846894.png" alt="image-20220614190846894" style="zoom: 50%;" />

为了防止上述信息被篡改，有了数字签名

#### 2)工作过程

上图

#### 3)作用：

保证信息来源的可靠性：我的公钥可以解开数字签名，说明一定是你的私钥加密的，那么就是你发来的，因此保证了可靠性

## 三、数字证书

> 我用公钥可以解开数字签名，但公钥可能是Hacker伪造的！ 此时我解开的就是Hacker的数字签名以及Hacker的信息

于是有了数字证书和CA认证机构

#### 1)数字证书是什么？

数字证书包含了：信息 + 服务器个人信息 + 数字签名

**CA认证机构生成数字证书**

- 服务器把自己的信息，给认证机构
- 机构生成对【服务器需要传递的信息+服务器个人信息】用自己的`机构私钥`生成 `数字签名`
- 机构将 【服务器需要传递的信息+服务器个人信息】+`数字签名`打包成 `数字证书` ，颁发给Server

**验证证书**

- Server将收到的`数字证书` + 传递的信息
- Client体内内置了CA认证机构的`机构公钥`，公钥能够解开数字签名，说明`数字证书`是被 CA认证机构认证的过 ：那么这个证书一定不是伪造的
   - 因为体内内置的机构公钥一定不是伪造的，是操作系统内置的



#### 2)数字证书的签发过程

1. 服务器将自己的信息注册到 `CA`

2. CA用`CA私钥`对信息加密生成`数字签名`， 并颁发`数字证书`(证书包含了服务器信息+数字签名)

3. 服务器将数字证书发送给Client

4. Client内置了权威的`CA公钥`（全世界的计算机都有）， Client用`CA公钥`解密

5. 解开了：说明数字证书是可靠来源的

   成功！！！

<img src="pic/2%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E4%B8%8E%E8%AF%81%E4%B9%A6%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F.assets/image-20220614193542875.png" alt="image-20220614193542875" style="zoom: 50%;" />





#### 3)数字证书的原理

上面没有具体用到HTTPS交互中

> 数字证书主要用于：确保服务器的身份。  
>
> Client需要Server的公钥，因此需要确定收到的公钥来源可靠 => 是服务器发的



**颁发数字证书**

1. 【hash值】服务器公钥+颁发者信息+用途+有效时间 打包， 计算机这个包得到的`hash值`
2. 【数字签名】CA机构用自己的`CA私钥`为hash值加密，得到 `数字签名`
3. 【数字证书】数字签名和 包 一起打包成：数字证书

**验证数字证书**

Client验证数字证书来源是否可靠

1. 【公钥解密】Client用 `CA公钥`(这个一定可靠) 解密数字签名，得到之前CA机构生成的`hash值A`
2. 【比较hash值】Client将数字证书中的内容信息 生成hash值B， 比较AB是否一致
3. 一致，则说明信息没有被篡改过，数字证书可信

<img src="pic/2%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E4%B8%8E%E8%AF%81%E4%B9%A6%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F.assets/image-20220614193700814.png" alt="image-20220614193700814" style="zoom:50%;" />